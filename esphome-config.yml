esphome:
  name: esphome-web-123456
  friendly_name: bedroom-lock
  on_boot:
    # Fail locked when power is restored
    then:
      - switch.turn_on: lock_switch

esp8266:
  board: d1_mini

# Enable logging
logger:

# Enable Home Assistant API
api:
  encryption:
    key: "encryptionkeyforapigoeshereusuallyautogenerated"

ota:

web_server:
  port: 80
  version: 2
  include_internal: true

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "esphome-web-123456"
    password: "fallbackkwifipassword"

captive_portal:

# Start board config
output:
  - platform: esp8266_pwm
    id: pwm_output
    pin: D7
    frequency: 50Hz

servo:
  - id: lock_servo
    output: pwm_output
    restore: true
    transition_length: 1s
    auto_detach_time: 2s

# number:
#   - platform: template
#     name: Servo Control
#     min_value: -100
#     initial_value: 0
#     max_value: 100
#     step: 1
#     optimistic: true
#     set_action:
#       then:
#         - servo.write:
#             id: lock_servo
#             level: !lambda 'return x / 100.0;'

switch:
  - platform: template
    id: lock_switch
    name: "Door Lock"
    icon: "mdi:lock"
    optimistic: true
    turn_on_action:
      - servo.write:
          id: lock_servo
          level: -0.7
    turn_off_action:
      - servo.write:
          id: lock_servo
          level: 0.8

binary_sensor:
  - platform: gpio
    name: "Switch"
    id: push_button
    on_press:
      then:
        switch.toggle: lock_switch
    pin:
      number: D1
      inverted: true
      mode:
        input: true
        pullup: true
